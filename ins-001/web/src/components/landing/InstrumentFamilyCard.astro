---
/**
 * Instrument Family Card Component
 * Shows a family card with inline child instruments, similar to methods on phronos.org
 */

interface ChildInstrument {
  id: string;
  title: string;
  status: 'live' | 'coming';
  href?: string;
}

interface Props {
  id: string;
  title: string;
  description: string;
  status: 'live' | 'coming';
  href: string;
  children: ChildInstrument[];
}

const { id, title, description, status, href, children } = Astro.props;
const liveCount = children.filter(c => c.status === 'live').length;
---

<div class="family-card">
  <a href={href} class="family-card-main">
    <div class="card-header">
      <span class="card-id">{id}</span>
      <span class:list={['card-status', status]}>
        {status === 'live' ? 'Live' : 'Coming'}
      </span>
    </div>
    <div class="card-body">
      <h3 class="card-title">{title}</h3>
      <p class="card-description">{description}</p>
      <div class="card-metrics">
        <div class="card-metric">
          <span class="card-metric-label">Instruments:</span>
          <span class="card-metric-value">{children.length}</span>
        </div>
        <div class="card-metric">
          <span class="card-metric-label">Live:</span>
          <span class="card-metric-value">{liveCount}</span>
        </div>
      </div>
    </div>
  </a>

  <!-- Child Instruments List -->
  <div class="children-section">
    {children.map((child) => (
      <a
        href={child.href || href}
        class:list={['child-row', { 'child-coming': child.status === 'coming' }]}
      >
        <span class="child-id">{child.id}</span>
        <span class="child-title">{child.title}</span>
        <span class:list={['child-status-dot', child.status]}></span>
      </a>
    ))}
  </div>

  <div class="card-footer">
    <a href={href} class="card-cta">
      View Family
    </a>
    <span class="card-arrow">â†’</span>
  </div>
</div>

<style>
  .family-card {
    background: var(--card-bg);
    border: 1px solid var(--faded-light);
    position: relative;
    transition: all var(--transition-default);
    display: flex;
    flex-direction: column;
  }

  .family-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image:
      linear-gradient(var(--faded-ultra) 1px, transparent 1px),
      linear-gradient(90deg, var(--faded-ultra) 1px, transparent 1px);
    background-size: 20px 20px;
    pointer-events: none;
    opacity: 0.5;
  }

  .family-card:hover {
    border-color: var(--gold);
    box-shadow: 5px 5px 0px var(--gold-dim);
    transform: translate(-2px, -2px);
  }

  .family-card-main {
    display: block;
    text-decoration: none;
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-sm) var(--space-md);
    border-bottom: 1px solid var(--faded-light);
    position: relative;
    z-index: 1;
  }

  .card-id {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--gold);
    text-transform: uppercase;
  }

  .card-status {
    font-family: var(--font-mono);
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 4px 8px;
    border: 1px solid;
  }

  .card-status.live {
    color: var(--active);
    border-color: var(--active);
  }

  .card-status.coming {
    color: var(--faded);
    border-color: var(--faded-light);
  }

  .card-body {
    padding: var(--space-md);
    position: relative;
    z-index: 1;
  }

  .card-title {
    font-family: var(--font-serif);
    font-size: 1.5rem;
    font-weight: 400;
    color: var(--text-light);
    margin-bottom: var(--space-xs);
  }

  .card-description {
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    color: var(--faded);
    line-height: 1.6;
    margin-bottom: var(--space-md);
  }

  .card-metrics {
    display: flex;
    gap: var(--space-md);
  }

  .card-metric {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
  }

  .card-metric-label {
    color: var(--faded);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .card-metric-value {
    color: var(--text-light);
  }

  /* Children Section */
  .children-section {
    border-top: 1px solid var(--faded-light);
    position: relative;
    z-index: 1;
  }

  .child-row {
    display: flex;
    align-items: center;
    padding: var(--space-sm) var(--space-md);
    border-bottom: 1px solid var(--faded-ultra);
    text-decoration: none;
    transition: background var(--transition-fast);
    gap: var(--space-sm);
  }

  .child-row:last-child {
    border-bottom: none;
  }

  .child-row:hover {
    background: rgba(var(--gold-rgb), 0.05);
  }

  .child-row.child-coming {
    opacity: 0.5;
    pointer-events: none;
  }

  .child-id {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--gold);
    min-width: 70px;
  }

  .child-title {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--text-light);
    flex: 1;
  }

  .child-status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
  }

  .child-status-dot.live {
    background: var(--active);
    animation: pulse 2s ease-in-out infinite;
  }

  .child-status-dot.coming {
    background: var(--faded);
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .card-footer {
    padding: var(--space-sm) var(--space-md);
    border-top: 1px solid var(--faded-light);
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    z-index: 1;
  }

  .card-cta {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--gold);
    text-transform: uppercase;
    letter-spacing: 1px;
    text-decoration: none;
  }

  .card-arrow {
    color: var(--gold);
    transition: transform var(--transition-default);
  }

  .family-card:hover .card-arrow {
    transform: translateX(4px);
  }
</style>
