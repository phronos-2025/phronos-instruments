import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as a}from"./index.WFquGv8Z.js";import{a as E,b as re}from"./bridging-state.BVL_BDqg.js";import{A as ne}from"./AuthProvider.YNBq_VlW.js";import{N as se}from"./Navigation.CkCgBJYb.js";import{P as M,B as A}from"./Button.D4eF3GIc.js";import{P as K,S as oe}from"./ShareLinkBox.93Hcaamo.js";import{a as F}from"./api.BTInGiQ9.js";import{s as Q}from"./supabase.DFNfmv87.js";import{M as ae}from"./MagicLinkModal.CHr2vfrA.js";import"./PhronosLogo.oVgHQy8-.js";const Z=()=>{const{dispatch:t}=E(),[c,n]=a.useState(!1),s=()=>{c&&t({type:"BEGIN"})};return e.jsxs("div",{children:[e.jsx(K,{currentStep:1}),e.jsxs("p",{className:"subtitle",children:[e.jsx("span",{className:"id",children:"INS-001.2"})," ¬∑ Common Ground"]}),e.jsx("h1",{className:"title",children:"Find common ground."}),e.jsx("p",{className:"description",children:"This instrument measures how you locate semantic intersection between two different conceptual domains. Choose two words and find concepts that belong to both."}),e.jsx(M,{title:"How It Works",meta:"~5 minutes",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"var(--space-md)",fontFamily:"var(--font-mono)",fontSize:"0.75rem"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--gold)",fontSize:"1.5rem",marginBottom:"var(--space-xs)"},children:"01"}),e.jsx("div",{style:{color:"var(--text-light)",marginBottom:"4px"},children:"Choose two words"}),e.jsx("div",{style:{color:"var(--faded)",fontSize:"0.65rem"},children:"Anchor and target."})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--gold)",fontSize:"1.5rem",marginBottom:"var(--space-xs)"},children:"02"}),e.jsx("div",{style:{color:"var(--text-light)",marginBottom:"4px"},children:"Find common ground"}),e.jsx("div",{style:{color:"var(--faded)",fontSize:"0.65rem"},children:"1-5 clues that belong to both."})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--gold)",fontSize:"1.5rem",marginBottom:"var(--space-xs)"},children:"03"}),e.jsx("div",{style:{color:"var(--text-light)",marginBottom:"4px"},children:"See what emerges"}),e.jsx("div",{style:{color:"var(--faded)",fontSize:"0.65rem"},children:"Divergence. Relevance."})]})]})}),e.jsx(M,{className:"",style:{background:"transparent",borderColor:"var(--gold-dim)"},children:e.jsxs("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.7rem",color:"var(--faded)"},children:[e.jsx("strong",{style:{color:"var(--text-light)"},children:"What this measures:"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{children:"Divergence"})," ‚Äî How far your clues arc from the direct path between anchor and target. High divergence indicates unexpected routes.",e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{children:"Relevance"})," ‚Äî How connected your clues are to both anchor and target. High relevance indicates clues in the shared semantic neighborhood."]})}),e.jsx("div",{style:{marginBottom:"var(--space-md)",textAlign:"left",maxWidth:"500px"},children:e.jsxs("label",{style:{display:"flex",gap:"var(--space-sm)",alignItems:"flex-start",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:c,onChange:g=>n(g.target.checked),style:{marginTop:"4px",accentColor:"var(--gold)",width:"16px",height:"16px",cursor:"pointer"}}),e.jsxs("span",{style:{fontFamily:"var(--font-mono)",fontSize:"0.7rem",color:"var(--faded)",lineHeight:"1.5"},children:["I agree to the"," ",e.jsx("a",{href:"https://phronos.org/terms",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--gold)",textDecoration:"none",borderBottom:"1px dotted"},children:"Terms of Service"})," ","and"," ",e.jsx("a",{href:"https://phronos.org/privacy",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--gold)",textDecoration:"none",borderBottom:"1px dotted"},children:"Privacy Policy"}),", and consent to the processing of my responses as described therein."]})]})}),e.jsx("div",{className:"btn-group",style:{marginTop:0},children:e.jsx(A,{variant:"primary",onClick:s,disabled:!c,children:"Begin Assessment"})}),e.jsx("p",{style:{fontFamily:"var(--font-mono)",fontSize:"0.65rem",color:"var(--faded)",marginTop:"var(--space-lg)"},children:"There are no correct answers‚Äîonly your connections."})]})},ie=({anchor:t,target:c})=>{const{dispatch:n}=E(),[s,g]=a.useState(t||""),[d,y]=a.useState(c||""),[f,I]=a.useState(!1),[k,N]=a.useState(!1),[C,B]=a.useState(!1),[z,b]=a.useState(1),[T,p]=a.useState(1),[o,r]=a.useState(null),[m,u]=a.useState(!1),[j,w]=a.useState(null),[l,Y]=a.useState(!1);a.useEffect(()=>{(async()=>{try{const{data:{session:v},error:S}=await Q.auth.getSession();if(S){console.error("Session error:",S),u(!0);return}if(!v){const{error:x}=await Q.auth.signInAnonymously();if(x){console.error("Auth error:",x),r(`Authentication failed: ${x.message}`),u(!0);return}}u(!0)}catch(v){console.error("Auth setup error:",v),u(!0)}})()},[]);const G=a.useCallback(async(i,v)=>{if(!i.trim()||!v.trim()||!m){w(null);return}const S=i.trim().toLowerCase(),x=v.trim().toLowerCase();if(S===x){w({anchor:S,target:x,distance:0,interpretation:"identical"});return}Y(!0);try{const _=await F.bridging.getDistance(S,x);w(_)}catch(_){console.error("Failed to get distance:",_),w(null)}finally{Y(!1)}},[m]);a.useEffect(()=>{const i=setTimeout(()=>{G(s,d)},500);return()=>clearTimeout(i)},[s,d,G]);const h=async()=>{N(!0);try{const i=await F.bridging.suggest(d||void 0,z);g(i.suggestion),b(v=>v+1)}catch(i){console.error("Suggest failed:",i)}finally{N(!1)}},R=async()=>{B(!0);try{const i=await F.bridging.suggest(s||void 0,T);y(i.suggestion),p(v=>v+1)}catch(i){console.error("Suggest failed:",i)}finally{B(!1)}},$=async i=>{if(i.preventDefault(),!s.trim()||!d.trim()||!m)return;const v=s.trim().toLowerCase(),S=d.trim().toLowerCase();if(v===S){r("Anchor and target must be different words");return}I(!0),r(null);try{const x=await F.bridging.create({anchor_word:v,target_word:S,recipient_type:"haiku"});n({type:"GAME_CREATED",gameId:x.game_id,anchor:x.anchor_word,target:x.target_word})}catch(x){r(x instanceof Error?x.message:"Failed to create game")}finally{I(!1)}},P=i=>({identical:"identical",close:"close ¬∑ try more distant concepts","below average":"below average distance",average:"average distance","above average":"good distance",distant:"very distant"})[i.interpretation]||i.interpretation,L=i=>i.interpretation==="above average"||i.interpretation==="distant";return e.jsxs("div",{children:[e.jsx(K,{currentStep:1}),e.jsxs("p",{className:"subtitle",children:[e.jsx("span",{className:"id",children:"INS-001.2"})," ¬∑ Step 1 of 3"]}),e.jsx("h1",{className:"title",children:"Choose your anchor and target."}),e.jsx("p",{className:"description",children:"Pick two words to connect. Your concepts will find common ground between them."}),m?e.jsxs("form",{onSubmit:$,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"var(--space-lg)",marginBottom:"var(--space-lg)"},children:[e.jsxs("div",{className:"input-group",style:{marginBottom:0},children:[e.jsx("label",{className:"input-label",children:"Anchor"}),e.jsx("input",{type:"text",className:"text-input",value:s,onChange:i=>g(i.target.value),placeholder:"coffee",autoComplete:"off",spellCheck:"false",autoFocus:!0,disabled:f}),e.jsx("button",{type:"button",onClick:h,disabled:k||f,style:{marginTop:"var(--space-xs)",background:"transparent",border:"1px solid var(--border)",color:"var(--faded)",padding:"0.5rem 1rem",fontSize:"0.75rem",fontFamily:"var(--font-mono)",cursor:"pointer",borderRadius:"4px"},children:k?"...":"Suggest"})]}),e.jsxs("div",{className:"input-group",style:{marginBottom:0},children:[e.jsx("label",{className:"input-label",children:"Target"}),e.jsx("input",{type:"text",className:"text-input",value:d,onChange:i=>y(i.target.value),placeholder:"sunshine",autoComplete:"off",spellCheck:"false",disabled:f}),e.jsx("button",{type:"button",onClick:R,disabled:C||f,style:{marginTop:"var(--space-xs)",background:"transparent",border:"1px solid var(--border)",color:"var(--faded)",padding:"0.5rem 1rem",fontSize:"0.75rem",fontFamily:"var(--font-mono)",cursor:"pointer",borderRadius:"4px"},children:C?"...":"Suggest"})]})]}),s&&d&&e.jsxs("div",{style:{textAlign:"center",fontFamily:"var(--font-mono)",marginBottom:"var(--space-lg)",padding:"var(--space-md)",border:"1px solid var(--gold-dim)",borderRadius:"4px"},children:[j&&!l&&e.jsx("div",{style:{fontSize:"0.7rem",color:j.interpretation==="identical"?"var(--alert)":L(j)?"var(--gold)":"var(--faded)",marginBottom:"var(--space-xs)",textTransform:"uppercase",letterSpacing:"0.05em"},children:P(j)}),l&&e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--faded)",marginBottom:"var(--space-xs)"},children:"..."}),e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--gold)"},children:[s.toLowerCase()," ‚Üê‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Üí ",d.toLowerCase()]})]}),e.jsx("p",{className:"input-hint",children:"Tip: Distant concepts make for more interesting common ground."}),o&&e.jsxs("div",{style:{color:"var(--alert)",marginTop:"1rem",fontSize:"var(--text-sm)"},children:["‚óà ",o]}),e.jsxs("div",{className:"btn-group",children:[e.jsx(A,{variant:"ghost",onClick:()=>n({type:"BACK"}),type:"button",children:"‚Üê Back"}),e.jsx(A,{type:"submit",variant:"primary",disabled:!s.trim()||!d.trim()||f||!m,children:f?"Creating...":"Continue ‚Üí"})]})]}):e.jsx("div",{style:{textAlign:"center",padding:"2rem",color:"var(--faded)"},children:"Initializing..."})]})};function ee(t){t=t.toLowerCase();const c=["ically","ation","ness","ment","able","ible","tion","sion","ally","ful","less","ing","ity","ous","ive","est","ier","ies","ied","ly","ed","er","en","es","s"];for(const n of c)if(t.endsWith(n)&&t.length>n.length+2)return t.slice(0,-n.length);return t}function X(t,c){const n=t.toLowerCase(),s=c.toLowerCase();return!!(n===s||(n.startsWith(s)||s.startsWith(n))&&Math.abs(n.length-s.length)<=4||ee(n)===ee(s))}const le=({gameId:t,anchor:c,target:n})=>{const{dispatch:s}=E(),[g,d]=a.useState(["","","","",""]),[y,f]=a.useState(!1),[I,k]=a.useState(null),N=(p,o)=>{const r=[...g];r[p]=o,d(r),k(null)},C=a.useMemo(()=>{const p=c.toLowerCase(),o=n.toLowerCase(),r=[];return g.map(m=>{const u=m.trim().toLowerCase();if(!u)return{status:"empty"};if(X(u,p))return{status:"invalid",error:`Too similar to anchor "${c}"`};if(X(u,o))return{status:"invalid",error:`Too similar to target "${n}"`};for(const j of r)if(X(u,j))return{status:"invalid",error:`Duplicate of "${j}"`};return r.push(u),{status:"valid"}})},[g,c,n]),B=C.filter(p=>p.status==="valid").length,z=C.some(p=>p.status==="invalid"),b=B>0&&!z&&!y,T=async p=>{if(p.preventDefault(),!!b){f(!0),k(null);try{const o=g.filter((m,u)=>C[u].status==="valid").map(m=>m.trim().toLowerCase()),r=await F.bridging.submitClues(t,{clues:o});if(r.status==="completed"&&(r.haiku_clues||r.haiku_guessed_anchor)){const m=await F.bridging.get(t);s({type:"GAME_COMPLETED",game:m})}else s({type:"STEPS_SUBMITTED",gameId:t,steps:r.clues,divergence:r.divergence_score,shareCode:r.share_code})}catch(o){k(o instanceof Error?o.message:"Failed to submit concepts")}finally{f(!1)}}};return e.jsxs("div",{children:[e.jsx(K,{currentStep:2}),e.jsxs("p",{className:"subtitle",children:[e.jsx("span",{className:"id",children:"INS-001.2"})," ¬∑ Step 2 of 3"]}),e.jsx("h1",{className:"title",children:"Find your common ground."}),e.jsx("p",{className:"description",children:"Enter single-word concepts that belong to both your anchor and target."}),e.jsxs("div",{style:{textAlign:"center",fontFamily:"var(--font-mono)",fontSize:"0.9rem",color:"var(--gold)",marginBottom:"var(--space-lg)",padding:"var(--space-md)",border:"1px solid var(--gold-dim)",borderRadius:"4px"},children:[c," ‚Üê‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Üí ",n]}),e.jsxs("form",{onSubmit:T,children:[e.jsxs("div",{className:"input-group",children:[e.jsxs("label",{className:"input-label",children:["Your Concepts"," ",e.jsxs("span",{style:{color:"var(--faded)",fontWeight:"normal"},children:[B,"/5 concepts"]})]}),g.map((p,o)=>{const r=C[o],m=r.status==="valid",u=r.status==="invalid",j=r.status==="empty";return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--space-sm)",marginBottom:"var(--space-sm)"},children:[e.jsx("span",{style:{fontFamily:"var(--font-mono)",fontSize:"0.75rem",color:"var(--faded)",width:"20px"},children:o+1}),e.jsx("input",{type:"text",className:"text-input",value:p,onChange:w=>N(o,w.target.value),placeholder:o===0?"first concept":"",autoComplete:"off",spellCheck:"false",autoFocus:o===0,disabled:y,style:{flex:1,marginBottom:0,borderColor:u?"var(--alert)":m?"var(--active)":void 0}}),e.jsxs("span",{style:{fontFamily:"var(--font-mono)",fontSize:"0.65rem",minWidth:"60px",textAlign:"right",color:u?"var(--alert)":m?"var(--active)":"var(--faded)"},children:[u&&"‚úó",m&&"‚úì",j&&o>0&&"(optional)"]})]},o)}),C.map((p,o)=>p.status==="invalid"&&p.error?e.jsxs("div",{style:{color:"var(--alert)",fontFamily:"var(--font-mono)",fontSize:"0.7rem",marginTop:"var(--space-xs)"},children:["Concept ",o+1,": ",p.error]},`error-${o}`):null),e.jsx("p",{className:"input-hint",children:"At least 1 concept required. More concepts provide more signal."})]}),I&&e.jsxs("div",{style:{color:"var(--alert)",marginTop:"1rem",fontSize:"var(--text-sm)"},children:["‚óà ",I]}),e.jsxs("div",{className:"btn-group",children:[e.jsx(A,{variant:"ghost",onClick:()=>s({type:"BACK"}),type:"button",children:"‚Üê Back"}),e.jsx(A,{type:"submit",variant:"primary",disabled:!b,children:y?"Submitting...":"Submit"})]})]})]})};function ce(t){return t<30?{label:"Predictable",description:"Your concepts stay close to the direct path between anchor and target."}:t<50?{label:"Moderate",description:"Your concepts take a moderately creative route."}:t<70?{label:"Creative",description:"Your concepts arc away from the obvious path."}:{label:"Highly Creative",description:"Your concepts take a highly unexpected route to connect the ideas."}}const de=({gameId:t,anchor:c,target:n,steps:s,divergence:g,shareCode:d})=>{const{dispatch:y}=E(),[f,I]=a.useState(d||""),[k,N]=a.useState(""),[C,B]=a.useState(!1),[z,b]=a.useState(!1),[T,p]=a.useState(!1),[o,r]=a.useState(null),m=ce(g),u=async()=>{if(f){j();return}B(!0),r(null);try{const l=await F.bridging.createShare(t);I(l.share_code),N(l.share_url)}catch(l){r(l instanceof Error?l.message:"Failed to create share link")}finally{B(!1)}},j=async()=>{const l=k||`${window.location.origin}/ins-001-2/join/${f}`;try{await navigator.clipboard.writeText(l),p(!0),setTimeout(()=>p(!1),2e3)}catch{r("Failed to copy to clipboard")}},w=async()=>{b(!0),r(null);try{await F.bridging.triggerHaikuBridge(t);const l=await F.bridging.get(t);y({type:"GAME_COMPLETED",game:l})}catch(l){r(l instanceof Error?l.message:"Failed to get Haiku union")}finally{b(!1)}};return e.jsxs("div",{children:[e.jsx(K,{currentStep:3}),e.jsxs("p",{className:"subtitle",children:[e.jsx("span",{className:"id",children:"INS-001.2"})," ¬∑ Step 3 of 3"]}),e.jsx("h1",{className:"title",children:"Common ground submitted."}),e.jsxs(M,{title:"Your Common Ground",meta:Math.round(g).toString(),style:{marginBottom:"var(--space-lg)"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"var(--space-md)"},children:[e.jsxs("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.9rem",color:"var(--gold)",marginBottom:"var(--space-sm)"},children:[c," ‚Üê‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Üí ",n]}),e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.8rem",color:"var(--text-light)"},children:s.join(" ¬∑ ")})]}),e.jsxs("div",{style:{marginBottom:"var(--space-md)"},children:[e.jsx("div",{style:{background:"var(--bg-card)",borderRadius:"4px",height:"8px",overflow:"hidden",marginBottom:"var(--space-xs)"},children:e.jsx("div",{style:{background:"var(--gold)",height:"100%",width:`${Math.min(100,g)}%`,transition:"width 0.3s ease"}})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontFamily:"var(--font-mono)",fontSize:"0.65rem",color:"var(--faded)"},children:[e.jsx("span",{children:"predictable"}),e.jsx("span",{children:"creative"})]})]}),e.jsxs("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.75rem",color:"var(--text-light)"},children:[e.jsx("strong",{style:{color:"var(--gold)"},children:m.label}),e.jsx("br",{}),e.jsx("span",{style:{color:"var(--faded)"},children:m.description})]})]}),e.jsx("p",{className:"description",children:"Who should find common ground?"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"var(--space-md)",marginBottom:"var(--space-lg)"},children:[e.jsxs("button",{onClick:u,disabled:C,style:{background:"transparent",border:"1px solid var(--border)",borderRadius:"8px",padding:"var(--space-md)",cursor:"pointer",textAlign:"left",transition:"border-color 0.2s"},onMouseEnter:l=>l.currentTarget.style.borderColor="var(--gold)",onMouseLeave:l=>l.currentTarget.style.borderColor="var(--border)",children:[e.jsx("div",{style:{fontSize:"1.5rem",marginBottom:"var(--space-xs)"},children:"üîó"}),e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.85rem",color:"var(--text-light)",marginBottom:"4px"},children:"Share with someone"}),e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.65rem",color:"var(--faded)"},children:"Send a link to a friend or colleague"})]}),e.jsxs("button",{onClick:w,disabled:z,style:{background:"transparent",border:"1px solid var(--border)",borderRadius:"8px",padding:"var(--space-md)",cursor:"pointer",textAlign:"left",transition:"border-color 0.2s"},onMouseEnter:l=>l.currentTarget.style.borderColor="var(--gold)",onMouseLeave:l=>l.currentTarget.style.borderColor="var(--border)",children:[e.jsx("div",{style:{fontSize:"1.5rem",marginBottom:"var(--space-xs)"},children:"ü§ñ"}),e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.85rem",color:"var(--text-light)",marginBottom:"4px"},children:z?"Finding...":"Let Haiku find"}),e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.65rem",color:"var(--faded)"},children:"See how Claude Haiku finds the same common ground"})]})]}),f&&e.jsxs("div",{style:{background:"var(--bg-card)",border:"1px solid var(--border)",borderRadius:"8px",padding:"var(--space-md)",marginBottom:"var(--space-lg)"},children:[e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.75rem",color:"var(--faded)",marginBottom:"var(--space-xs)"},children:"Share link"}),e.jsxs("div",{style:{display:"flex",gap:"var(--space-sm)",alignItems:"center"},children:[e.jsx("input",{type:"text",readOnly:!0,value:k||`${window.location.origin}/ins-001-2/join/${f}`,style:{flex:1,background:"transparent",border:"none",fontFamily:"var(--font-mono)",fontSize:"0.8rem",color:"var(--text-light)",outline:"none"}}),e.jsx(A,{variant:"secondary",onClick:j,children:T?"Copied!":"Copy"})]})]}),o&&e.jsxs("div",{style:{color:"var(--alert)",marginBottom:"var(--space-md)",fontSize:"var(--text-sm)"},children:["‚óà ",o]}),e.jsx("div",{className:"btn-group",children:e.jsx(A,{variant:"ghost",onClick:()=>y({type:"RESET"}),children:"Build Another ‚Üí"})})]})};function O({label:t,concepts:c,relevance:n,spread:s,isYou:g}){const d=y=>Math.min(100,Math.max(0,y));return e.jsxs("div",{style:{marginBottom:"var(--space-lg)"},children:[e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.75rem",color:g?"var(--gold)":"var(--text-light)",marginBottom:"var(--space-xs)",letterSpacing:"0.02em",textAlign:"center",marginLeft:"92px"},children:c.join(" ¬∑ ")}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--space-sm)"},children:[e.jsx("div",{style:{width:"80px",fontFamily:"var(--font-mono)",fontSize:"0.65rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",color:g?"var(--gold)":"var(--text-light)"},children:t}),e.jsxs("div",{style:{flex:1,height:"32px",position:"relative",backgroundColor:"rgba(255, 255, 255, 0.08)",borderRadius:"2px",marginBottom:"16px"},children:[[25,50,75].map(y=>e.jsx("div",{style:{position:"absolute",left:`${y}%`,top:0,bottom:0,width:"1px",backgroundColor:"rgba(255, 255, 255, 0.05)"}},y)),e.jsx("div",{style:{position:"absolute",left:`${d(n)}%`,width:`${Math.max(0,d(s)-d(n))}%`,top:"50%",height:"2px",backgroundColor:"var(--gold)",opacity:.4,transform:"translateY(-50%)"}}),e.jsx("div",{style:{position:"absolute",left:`${d(n)}%`,top:"50%",transform:"translate(-50%, -50%)",width:"12px",height:"12px",borderRadius:"50%",backgroundColor:"var(--gold)"}}),e.jsx("div",{style:{position:"absolute",left:`${d(s)}%`,top:"50%",transform:"translate(-50%, -50%)",width:"12px",height:"12px",borderRadius:"50%",border:"2px solid var(--gold)",backgroundColor:"var(--bg)",boxSizing:"border-box"}}),e.jsx("span",{style:{position:"absolute",left:`${d(n)}%`,bottom:"-16px",transform:"translateX(-50%)",fontFamily:"var(--font-mono)",fontSize:"0.6rem",color:"var(--gold)"},children:Math.round(n)}),e.jsx("span",{style:{position:"absolute",left:`${d(s)}%`,bottom:"-16px",transform:"translateX(-50%)",fontFamily:"var(--font-mono)",fontSize:"0.6rem",color:"var(--faded)"},children:Math.round(s)})]})]})]})}function pe({shareUrl:t,isCreatingShare:c,shareError:n,onCreateShare:s}){return e.jsxs("div",{style:{marginBottom:"var(--space-lg)"},children:[e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.75rem",color:"var(--faded)",marginBottom:"var(--space-xs)",letterSpacing:"0.02em",fontStyle:"italic",textAlign:"center",marginLeft:"92px"},children:"compare your concepts"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--space-sm)"},children:[e.jsx("div",{style:{width:"80px",fontFamily:"var(--font-mono)",fontSize:"0.65rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--text-light)"},children:"Human"}),e.jsxs("div",{style:{flex:1,height:"32px",position:"relative",backgroundColor:"rgba(255, 255, 255, 0.08)",borderRadius:"2px",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{style:{position:"absolute",left:"10%",right:"10%",top:"50%",height:"1px",borderTop:"1px dashed var(--border)",transform:"translateY(-50%)"}}),!t&&e.jsx("div",{style:{position:"relative",zIndex:1},children:e.jsx(A,{variant:"secondary",onClick:s,disabled:c,style:{fontSize:"0.65rem",padding:"4px 12px"},children:c?"Creating...":"Create Share Link"})})]})]}),t&&e.jsx("div",{style:{marginTop:"var(--space-sm)",marginLeft:"92px"},children:e.jsx(oe,{url:t})}),n&&e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.6rem",color:"var(--alert)",marginTop:"var(--space-xs)",marginLeft:"92px"},children:n})]})}function me({concepts:t,relevance:c,spread:n}){return e.jsx(O,{label:"Human",concepts:t,relevance:c,spread:n})}const ue=({game:t})=>{const{dispatch:c}=E(),[n,s]=a.useState(t.share_code?`${window.location.origin}/ins-001-2/join/${t.share_code}`:null),[g,d]=a.useState(!1),[y,f]=a.useState(null),[I,k]=a.useState(!1),N=t.relevance??t.binding_score??0,C=t.divergence??t.divergence_score??0,B=N<=1?N*100:N,z=t.haiku_clues,b=t.haiku_relevance??t.haiku_binding,T=t.haiku_divergence,p=z&&z.length>0,o=t.lexical_bridge,r=t.lexical_relevance,m=t.lexical_divergence??t.lexical_similarity,u=o&&o.length>0,j=t.recipient_clues,w=t.recipient_relevance??t.recipient_binding,l=t.recipient_divergence,Y=j&&j.length>0,G=async()=>{d(!0),f(null);try{const h=await F.bridging.createShare(t.game_id);s(h.share_url)}catch(h){f(h instanceof Error?h.message:"Failed to create share link")}finally{d(!1)}};return e.jsxs("div",{children:[e.jsxs("p",{className:"subtitle",children:[e.jsx("span",{className:"id",children:"INS-001.2"})," ¬∑ Your Results"]}),e.jsx("h1",{className:"title",children:"Common Ground Analysis"}),e.jsxs(M,{children:[e.jsxs("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.8rem",color:"var(--gold)",textAlign:"center",marginBottom:"var(--space-lg)"},children:[t.anchor_word," ‚Üê‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Üí ",t.target_word]}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"var(--space-md)",marginBottom:"var(--space-md)",fontFamily:"var(--font-mono)",fontSize:"0.6rem",textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--faded)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"var(--gold)"}}),e.jsx("span",{children:"Relevance"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",border:"2px solid var(--gold)",backgroundColor:"transparent",boxSizing:"border-box"}}),e.jsx("span",{children:"Spread"})]})]}),e.jsxs("div",{style:{marginLeft:"92px",marginRight:"12px",marginBottom:"var(--space-sm)"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",fontFamily:"var(--font-mono)",fontSize:"11px",color:"var(--faded)",marginBottom:"2px"},children:[0,25,50,75,100].map(h=>e.jsx("span",{children:h},h))}),e.jsx("div",{style:{height:"1px",backgroundColor:"var(--border)",position:"relative"},children:[0,25,50,75,100].map(h=>e.jsx("div",{style:{position:"absolute",left:`${h}%`,top:"-2px",width:"1px",height:"5px",backgroundColor:"var(--border)"}},h))})]}),e.jsxs("div",{style:{marginTop:"var(--space-md)"},children:[e.jsx(O,{label:"You",concepts:t.clues||[],relevance:B,spread:C,isYou:!0}),p&&b!==void 0&&T!==void 0&&e.jsx(O,{label:"Haiku",concepts:z,relevance:b<=1?b*100:b,spread:T}),u&&r!=null&&m!=null&&e.jsx(O,{label:"Statistical",concepts:o,relevance:r<=1?r*100:r,spread:m}),Y&&w!==void 0&&l!==void 0?e.jsx(me,{concepts:j,relevance:w<=1?w*100:w,spread:l}):e.jsx(pe,{shareUrl:n,isCreatingShare:g,shareError:y,onCreateShare:G})]})]}),e.jsxs(M,{style:{background:"transparent",borderColor:"var(--faded-light)"},children:[e.jsx("div",{className:"panel-header",children:e.jsx("span",{className:"panel-title",children:"Interpretation"})}),e.jsx("div",{className:"panel-content",style:{fontFamily:"var(--font-body)",fontSize:"0.9rem",color:"var(--faded)",lineHeight:"1.7"},children:(()=>{const h=Math.round(B),R=Math.round(C),$=p&&b!==void 0?Math.round(b<=1?b*100:b):null,P=p&&T!==void 0?Math.round(T):null,L=u&&r!=null?Math.round(r<=1?r*100:r):null,i=u&&m!=null?Math.round(m):null,v=(te,q,V)=>{if(q===null)return null;const J=te-q;return Math.abs(J)<=5?`on par with ${V}`:J>0?`higher than ${V}`:`lower than ${V}`},S=v(h,$,"Haiku"),x=v(h,L,"the statistical model");let _=`Your relevance (${h}) is `;S&&x?_+=`${S}, and ${x}.`:S?_+=`${S}.`:x?_+=`${x}.`:_=`Your relevance is ${h}.`;const W=v(R,P,"Haiku"),U=v(R,i,"the statistical model");let D=` Your spread (${R}) is `;W&&U?D+=`${W}, and ${U}`:W?D+=`${W}`:U?D+=`${U}`:D=` Your spread is ${R}`;let H="";return R>(P??50)&&R>(i??50)?H=", which may indicate your concepts are more diverse but less focused on the semantic bridge between anchor and target.":h>($??50)&&h>(L??50)?H=", suggesting strong conceptual bridging between the anchor and target.":h<($??50)&&h<(L??50)?H=". The bridging concepts may be too distant from the semantic space between anchor and target.":H=".",_+D+H})()})]}),e.jsxs(M,{style:{borderColor:"var(--gold)",background:"linear-gradient(to bottom, var(--card-bg), rgba(176, 141, 85, 0.05))",marginTop:"var(--space-md)"},children:[e.jsxs("div",{className:"panel-header",style:{borderBottomColor:"var(--gold-dim)"},children:[e.jsx("span",{className:"panel-title",style:{color:"var(--gold)"},children:"Unregistered Record"}),e.jsxs("span",{className:"panel-meta",children:["Session ID: #",t.game_id?.slice(0,4).toUpperCase()||"----"]})]}),e.jsx("div",{className:"panel-content",children:e.jsxs("div",{style:{display:"flex",gap:"var(--space-md)",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},children:[e.jsx("div",{style:{flex:1,minWidth:"200px"},children:e.jsx("p",{style:{fontFamily:"var(--font-mono)",fontSize:"0.75rem",color:"var(--text-light)",marginBottom:"var(--space-xs)"},children:"Save your scores to your permanent cognitive profile."})}),e.jsx(A,{variant:"primary",style:{fontSize:"0.65rem",padding:"10px 20px"},onClick:()=>k(!0),children:"Initialize ID"})]})})]}),e.jsx("div",{className:"btn-group",style:{marginTop:"var(--space-md)"},children:e.jsx(A,{variant:"primary",onClick:()=>c({type:"RESET"}),children:"Find More Common Ground"})}),e.jsx(ae,{isOpen:I,onClose:()=>k(!1)})]})};function he(){const{state:t}=E();switch(t.screen){case"intro":return e.jsx(Z,{});case"anchor-target":return e.jsx(ie,{anchor:t.anchor,target:t.target});case"steps":return e.jsx(le,{gameId:t.gameId,anchor:t.anchor,target:t.target});case"share":return e.jsx(de,{gameId:t.gameId,anchor:t.anchor,target:t.target,steps:t.steps,divergence:t.divergence,shareCode:t.shareCode});case"results":return e.jsx(ue,{game:t.game});default:return e.jsx(Z,{})}}function Be(){return e.jsx(ne,{children:e.jsxs(re,{children:[e.jsx(se,{instrumentId:"INS-001.2",instrumentTitle:"COMMON GROUND"}),e.jsx(he,{})]})})}export{Be as default};
