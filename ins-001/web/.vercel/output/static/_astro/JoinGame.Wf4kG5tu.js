import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as u}from"./index.WFquGv8Z.js";import{s as f}from"./supabase.Dq7CRccX.js";import{a as p}from"./api.Dr1Iqu3o.js";import{P as v,B as x}from"./Button.D4eF3GIc.js";const y=({number:s,value:t,onChange:r,noiseFloor:c=[]})=>{const i=t.trim(),o=i!=="",l=o&&c.some(m=>m.word.toLowerCase()===i.toLowerCase()),d=o?l?"warning":"valid":"",h=o?l?"⚠":"✓":"";return e.jsxs("div",{className:"clue-row",children:[e.jsx("span",{className:"clue-number",children:s}),e.jsx("input",{type:"text",className:`clue-input ${d}`,value:t,onChange:m=>r(m.target.value),placeholder:"Enter clue...",autoComplete:"off",spellCheck:"false"}),e.jsx("span",{className:`clue-status ${d}`,children:h})]})},b=({game:s,onGuessesSubmitted:t})=>{const[r,c]=u.useState(["","",""]),[i,o]=u.useState(!1),[l,d]=u.useState(null),h=(n,a)=>{const g=[...r];g[n]=a,c(g)},m=r.every(n=>n.trim()!==""),j=async()=>{if(m){o(!0),d(null);try{const n=await p.games.submitGuesses(s.game_id,{guesses:r.map(a=>a.trim())});t(n,r.map(a=>a.trim()))}catch(n){d(n instanceof Error?n.message:"Failed to submit guesses")}finally{o(!1)}}};return e.jsx("div",{children:e.jsxs(v,{title:"Guess the Word",children:[s.sender_display_name&&e.jsxs("p",{style:{marginBottom:"1rem",color:"var(--faded)"},children:[s.sender_display_name," wrote these clues:"]}),e.jsxs("div",{style:{marginBottom:"1.5rem",padding:"1rem",background:"var(--card-bg)",border:"1px solid var(--faded-light)"},children:[e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"var(--text-xs)",color:"var(--faded)",marginBottom:"0.5rem"},children:"CLUES"}),e.jsx("div",{style:{color:"var(--text-light)",lineHeight:"1.8"},children:s.clues.map((n,a)=>e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[a+1,". ",n]},a))})]}),e.jsx("p",{style:{marginBottom:"1rem",color:"var(--faded)"},children:"Enter 3 guesses. Any word is accepted."}),e.jsx("div",{className:"clue-inputs",children:r.map((n,a)=>e.jsx(y,{number:a+1,value:n,onChange:g=>h(a,g)},a))}),l&&e.jsxs("div",{style:{color:"var(--alert)",marginTop:"1rem",fontSize:"var(--text-sm)"},children:["◈ ",l]}),e.jsx("div",{className:"btn-group",children:e.jsx(x,{variant:"primary",onClick:j,disabled:!m||i,children:i?"Submitting...":"Submit Guesses"})})]})})},S=({label:s,value:t,interpretation:r})=>{const c=Math.round(t*100);return e.jsxs("div",{className:"score-card",children:[e.jsx("div",{className:"score-label",children:s}),e.jsx("div",{className:"score-value",children:t.toFixed(2)}),r&&e.jsx("div",{className:"score-interpretation",children:r}),e.jsx("div",{className:"score-bar",children:e.jsx("div",{className:"score-bar-fill",style:{width:`${c}%`}})})]})},w=({game:s,guesses:t})=>{const r=s.convergence_score<.4?"Low convergence":s.convergence_score<.7?"Partial convergence":"High convergence";return e.jsxs("div",{children:[e.jsxs(v,{title:"Results",children:[s.exact_match?e.jsx("div",{style:{padding:"1.5rem",background:"var(--active)",color:"var(--bg-deep)",textAlign:"center",marginBottom:"1.5rem",fontFamily:"var(--font-serif)",fontSize:"1.2rem"},children:"✓ Correct! You guessed it!"}):e.jsxs("div",{style:{padding:"1.5rem",background:"var(--card-bg)",border:"1px solid var(--faded-light)",textAlign:"center",marginBottom:"1.5rem"},children:[e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"var(--text-xs)",color:"var(--faded)",marginBottom:"0.5rem"},children:"YOUR GUESSES"}),e.jsx("div",{style:{color:"var(--text-light)"},children:t.join(", ")})]}),e.jsx(S,{label:"Convergence",value:s.convergence_score,interpretation:r}),e.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"var(--card-bg)",border:"1px solid var(--faded-light)"},children:[e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"var(--text-xs)",color:"var(--faded)",marginBottom:"0.5rem"},children:"THE WORD WAS"}),e.jsx("div",{style:{fontFamily:"var(--font-serif)",fontSize:"1.5rem",color:"var(--gold)"},children:s.seed_word})]}),e.jsx("p",{style:{marginTop:"1.5rem",color:"var(--faded)",fontSize:"var(--text-sm)"},children:"Convergence measures how well the sender's clues communicated their intended word. Higher scores indicate successful semantic transmission."})]}),e.jsx("div",{style:{textAlign:"center",marginTop:"2rem"},children:e.jsx(x,{variant:"primary",onClick:()=>window.location.href="/",children:"Play Your Own Game"})})]})},C=({error:s})=>{const t=()=>{switch(s){case"expired":return{title:"Link Expired",message:"This link has expired.",detail:"Ask your friend for a new one."};case"already_joined":return{title:"Already Joined",message:"This game already has a recipient.",detail:"The sender can generate a new link if needed."};case"not_found":return{title:"Game Not Found",message:"This game could not be found.",detail:"The link may be invalid or the game may have been deleted."};case"network":return{title:"Connection Error",message:"Failed to connect to the server.",detail:"Please check your connection and try again."};default:return{title:"Error",message:"An unexpected error occurred.",detail:"Please try again later."}}},{title:r,message:c,detail:i}=t();return e.jsx("div",{children:e.jsxs(v,{title:r,children:[e.jsxs("div",{style:{textAlign:"center",padding:"2rem 0"},children:[e.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem",color:"var(--alert)"},children:"◈"}),e.jsx("p",{style:{fontSize:"1.2rem",color:"var(--text-light)",marginBottom:"0.5rem"},children:c}),e.jsx("p",{style:{fontSize:"var(--text-sm)",color:"var(--faded)"},children:i})]}),e.jsx("div",{style:{textAlign:"center",marginTop:"2rem"},children:e.jsx(x,{variant:"primary",onClick:()=>window.location.href="/",children:"Back to Home"})})]})})};function _({token:s}){const[t,r]=u.useState({screen:"loading",token:s});u.useEffect(()=>{(async()=>{const{data:{session:o}}=await f.auth.getSession();o||await f.auth.signInAnonymously();try{const l=await p.share.join(s);r({screen:"join",game:l})}catch(l){const d=l instanceof Error?l.message:"Unknown error";d.includes("expired")?r({screen:"error",error:"expired"}):d.includes("already has a recipient")?r({screen:"error",error:"already_joined"}):d.includes("not found")?r({screen:"error",error:"not_found"}):r({screen:"error",error:"network"})}})()},[s]);const c=(i,o)=>{r({screen:"results",game:i,guesses:o})};switch(t.screen){case"loading":return e.jsx("div",{style:{textAlign:"center",padding:"2rem",color:"var(--faded)"},children:"Loading..."});case"error":return e.jsx(C,{error:t.error});case"join":return e.jsx(b,{game:t.game,onGuessesSubmitted:c});case"results":return e.jsx(w,{game:t.game,guesses:t.guesses});default:return null}}export{_ as default};
