import{s as d}from"./supabase.DFNfmv87.js";const e=document.getElementById("status");async function k(){try{console.log("[Auth Callback] Starting..."),console.log("[Auth Callback] URL hash:",window.location.hash),console.log("[Auth Callback] URL search:",window.location.search);const o=new URLSearchParams(window.location.search).get("returnTo")||"/";console.log("[Auth Callback] Return path:",o);const a=window.location.hash,s=new URLSearchParams(a.substring(1)),h=s.get("error"),l=s.get("error_description");if(h){console.log("[Auth Callback] Error in hash:",h,l);const t=l?decodeURIComponent(l.replace(/\+/g," ")):"Authentication failed";e.textContent=t,e.style.color="var(--alert)",setTimeout(()=>{window.location.href=o},3e3);return}if(a&&a.includes("access_token")){console.log("[Auth Callback] Found access_token in hash");const t=s.get("access_token"),c=s.get("refresh_token");if(console.log("[Auth Callback] Access token exists:",!!t),console.log("[Auth Callback] Refresh token exists:",!!c),t&&c){console.log("[Auth Callback] Setting session...");const{data:g,error:i}=await d.auth.setSession({access_token:t,refresh_token:c});if(console.log("[Auth Callback] setSession result:",{data:g,error:i}),i)throw i;if(g.session){console.log("[Auth Callback] Session established, redirecting..."),e.textContent="Signed in successfully! Redirecting...",window.history.replaceState(null,"",window.location.pathname),setTimeout(()=>{window.location.href=o},1500);return}}}else console.log("[Auth Callback] No access_token in hash");console.log("[Auth Callback] Checking existing session...");const{data:{session:u},error:r}=await d.auth.getSession();if(console.log("[Auth Callback] getSession result:",{session:u,error:r}),r)throw r;u?(console.log("[Auth Callback] Existing session found, redirecting..."),e.textContent="Signed in successfully! Redirecting...",setTimeout(()=>{window.location.href=o},1500)):(console.log("[Auth Callback] No session found"),e.textContent="Link expired or invalid. Redirecting...",e.style.color="var(--alert)",setTimeout(()=>{window.location.href=o},2e3))}catch(n){console.error("Auth callback error:",n),e.textContent=`Error: ${n.message}`,e.style.color="var(--alert)",setTimeout(()=>{window.location.href=returnTo},3e3)}}k();
