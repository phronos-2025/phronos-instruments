import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as c}from"./index.WFquGv8Z.js";import{u as R,A as P}from"./AuthProvider.YNBq_VlW.js";import{N as $}from"./Navigation.CkCgBJYb.js";import{P as N,B as b}from"./Button.D4eF3GIc.js";import{P as E,S as D}from"./ShareLinkBox.93Hcaamo.js";import{a as k}from"./api.BTInGiQ9.js";import{s as B}from"./supabase.DFNfmv87.js";import{M as G}from"./MagicLinkModal.CHr2vfrA.js";import"./PhronosLogo.oVgHQy8-.js";function Y(s,t){switch(t.type){case"BEGIN":return{screen:"seed"};case"BACK":return s.screen==="clues"?{screen:"seed"}:s.screen==="share"&&s.noiseFloor&&s.seedWord?{screen:"clues",gameId:s.gameId,noiseFloor:s.noiseFloor,seedWord:s.seedWord}:s.screen==="share"?{screen:"seed"}:s.screen==="seed"?{screen:"intro"}:s;case"SEED_SUBMITTED":return t.isPolysemous&&t.senseOptions?{screen:"sense",seedWord:t.seedWord,senseOptions:t.senseOptions}:t.gameId&&t.noiseFloor?{screen:"clues",gameId:t.gameId,noiseFloor:t.noiseFloor,seedWord:t.seedWord}:s;case"SENSE_SELECTED":return{screen:"clues",gameId:t.gameId,noiseFloor:t.noiseFloor,seedWord:t.seedWord};case"CLUES_SUBMITTED":return{screen:"share",gameId:t.gameId,divergence:t.divergence,noiseFloor:t.noiseFloor,seedWord:t.seedWord};case"GAME_COMPLETED":return{screen:"results",game:t.game};case"RESET":return{screen:"intro"};default:return s}}const W=c.createContext(void 0);function O({children:s}){const[t,o]=c.useReducer(Y,{screen:"intro"});return e.jsx(W.Provider,{value:{state:t,dispatch:o},children:s})}function I(){const s=c.useContext(W);if(!s)throw new Error("useGameState must be used within GameProvider");return s}const _=()=>{const{dispatch:s}=I(),[t,o]=c.useState(!1),n=()=>{t&&s({type:"BEGIN"})};return e.jsxs("div",{children:[e.jsx(E,{currentStep:1}),e.jsxs("p",{className:"subtitle",children:[e.jsx("span",{className:"id",children:"INS-001.1"})," Â· Signal"]}),e.jsx("h1",{className:"title",children:"Map a signal."}),e.jsx("p",{className:"description",children:"This instrument measures two dimensions of cognition: how divergently you associate concepts, and how effectively you communicate those associations to others."}),e.jsx(N,{title:"How It Works",meta:"~5 minutes",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"var(--space-md)",fontFamily:"var(--font-mono)",fontSize:"0.75rem"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--gold)",fontSize:"1.5rem",marginBottom:"var(--space-xs)"},children:"01"}),e.jsx("div",{style:{color:"var(--text-light)",marginBottom:"4px"},children:"Choose a word"}),e.jsx("div",{style:{color:"var(--faded)",fontSize:"0.65rem"},children:"Any word. Your target."})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--gold)",fontSize:"1.5rem",marginBottom:"var(--space-xs)"},children:"02"}),e.jsx("div",{style:{color:"var(--text-light)",marginBottom:"4px"},children:"Give 1-5 concepts"}),e.jsx("div",{style:{color:"var(--faded)",fontSize:"0.65rem"},children:"One-word associations."})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--gold)",fontSize:"1.5rem",marginBottom:"var(--space-xs)"},children:"03"}),e.jsx("div",{style:{color:"var(--text-light)",marginBottom:"4px"},children:"See what emerges"}),e.jsx("div",{style:{color:"var(--faded)",fontSize:"0.65rem"},children:"Divergence. Convergence."})]})]})}),e.jsx(N,{className:"",style:{background:"transparent",borderColor:"var(--gold-dim)"},children:e.jsxs("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.7rem",color:"var(--faded)"},children:[e.jsx("strong",{style:{color:"var(--text-light)"},children:"What this measures:"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{children:"Divergence"})," â€” How far your associations venture from the predictable. High divergence indicates unexpected semantic paths.",e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{children:"Convergence"})," â€” How accurately others can decode your associations. High convergence indicates effective communication of meaning."]})}),e.jsx("div",{style:{marginBottom:"var(--space-md)",textAlign:"left",maxWidth:"500px"},children:e.jsxs("label",{style:{display:"flex",gap:"var(--space-sm)",alignItems:"flex-start",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:t,onChange:r=>o(r.target.checked),style:{marginTop:"4px",accentColor:"var(--gold)",width:"16px",height:"16px",cursor:"pointer"}}),e.jsxs("span",{style:{fontFamily:"var(--font-mono)",fontSize:"0.7rem",color:"var(--faded)",lineHeight:"1.5"},children:["I agree to the"," ",e.jsx("a",{href:"https://phronos.org/terms",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--gold)",textDecoration:"none",borderBottom:"1px dotted"},children:"Terms of Service"})," ","and"," ",e.jsx("a",{href:"https://phronos.org/privacy",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--gold)",textDecoration:"none",borderBottom:"1px dotted"},children:"Privacy Policy"}),", and consent to the processing of my responses as described therein."]})]})}),e.jsx("div",{className:"btn-group",style:{marginTop:0},children:e.jsx(b,{variant:"primary",onClick:n,disabled:!t,children:"Begin Assessment"})}),e.jsx("p",{style:{fontFamily:"var(--font-mono)",fontSize:"0.65rem",color:"var(--faded)",marginTop:"var(--space-lg)"},children:"There are no correct answersâ€”only your signal."})]})},H=()=>{const{dispatch:s}=I(),[t,o]=c.useState(""),[n,r]=c.useState(!1),[d,h]=c.useState(!1),[C,m]=c.useState(1),[j,g]=c.useState(null),[x,v]=c.useState(!1);c.useEffect(()=>{const p=async()=>{try{const{data:{session:l},error:i}=await B.auth.getSession();if(i){console.error("Session error:",i),g(`Session error: ${i.message}`),v(!0);return}if(!l){const{data:f,error:y}=await B.auth.signInAnonymously();if(y){console.error("Auth error:",y),g(`Authentication failed: ${y.message}. You can still try to continue.`),v(!0);return}if(!f.session){console.error("No session after anonymous sign-in"),g("Failed to create anonymous session. Please refresh the page."),v(!0);return}}v(!0)}catch(l){console.error("Auth setup error:",l),g(`Failed to initialize: ${l instanceof Error?l.message:"Unknown error"}`),v(!0)}},a=setTimeout(()=>{x||(console.warn("Auth initialization timeout"),g("Authentication is taking longer than expected. You can try to continue."),v(!0))},5e3);p().finally(()=>{clearTimeout(a)})},[x]);const S=async()=>{h(!0);try{const p=await k.games.suggest(C);o(p.suggestion),m(a=>a+1)}catch(p){console.error("Suggest failed:",p)}finally{h(!1)}},T=async p=>{if(p.preventDefault(),!(!t.trim()||!x)){r(!0),g(null);try{const a=await k.games.create({seed_word:t.trim(),recipient_type:"llm"});a.is_polysemous&&a.sense_options?s({type:"SEED_SUBMITTED",seedWord:t.trim(),isPolysemous:!0,senseOptions:a.sense_options}):s({type:"SEED_SUBMITTED",seedWord:t.trim(),isPolysemous:!1,gameId:a.game_id,noiseFloor:a.noise_floor})}catch(a){g(a instanceof Error?a.message:"Failed to create game")}finally{r(!1)}}};return e.jsxs("div",{children:[e.jsx(E,{currentStep:1}),e.jsxs("p",{className:"subtitle",children:[e.jsx("span",{className:"id",children:"INS-001.1"})," Â· Step 1 of 3"]}),e.jsx("h1",{className:"title",children:"Choose your word."}),e.jsx("p",{className:"description",children:"Pick any word as your target. This is the concept you will communicate through associations."}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Target Word"}),x?e.jsxs("form",{onSubmit:T,children:[e.jsx("input",{type:"text",className:"text-input",value:t,onChange:p=>o(p.target.value),placeholder:"coffee",autoComplete:"off",spellCheck:"false",autoFocus:!0,disabled:n}),e.jsx("button",{type:"button",onClick:S,disabled:d||n,style:{marginTop:"var(--space-xs)",background:"transparent",border:"1px solid var(--border)",color:"var(--faded)",padding:"0.5rem 1rem",fontSize:"0.75rem",fontFamily:"var(--font-mono)",cursor:"pointer",borderRadius:"4px"},children:d?"...":"Suggest"}),e.jsx("p",{className:"input-hint",children:"Any word works: common words, technical terms, proper nouns, slang."}),j&&e.jsxs("div",{style:{color:"var(--alert)",marginTop:"1rem",fontSize:"var(--text-sm)"},children:["â—ˆ ",j]}),e.jsxs("div",{className:"btn-group",children:[e.jsx(b,{variant:"ghost",onClick:()=>s({type:"RESET"}),type:"button",children:"â† Back"}),e.jsx(b,{type:"submit",variant:"primary",disabled:!t.trim()||n||!x,children:n?"Creating...":"Continue â†’"})]})]}):e.jsx("div",{style:{textAlign:"center",padding:"2rem",color:"var(--faded)"},children:"Initializing..."})]})]})},U=({seedWord:s,senseOptions:t})=>{const{dispatch:o}=I(),[n,r]=c.useState(null),[d,h]=c.useState(!1),C=async()=>{if(n){h(!0);try{const m=await k.games.create({seed_word:s,seed_word_sense:n,recipient_type:"llm"});o({type:"SENSE_SELECTED",gameId:m.game_id,noiseFloor:m.noise_floor,seedWord:s})}catch(m){console.error("Failed to create game with sense:",m)}finally{h(!1)}}};return e.jsxs("div",{children:[e.jsx(E,{currentStep:1}),e.jsxs(N,{title:"Clarify Meaning",children:[e.jsxs("p",{style:{marginBottom:"1.5rem",color:"var(--faded)"},children:["The word ",e.jsxs("strong",{style:{color:"var(--gold)"},children:['"',s,'"']})," has multiple meanings. Which one do you mean?"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:t.map((m,j)=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem",border:"1px solid var(--faded-light)",cursor:"pointer",transition:"all 0.2s",backgroundColor:n===m?"var(--gold-dim)":"transparent"},onClick:()=>r(m),children:[e.jsx("input",{type:"radio",name:"sense",value:m,checked:n===m,onChange:()=>r(m),style:{cursor:"pointer"}}),e.jsx("span",{style:{color:"var(--text-light)"},children:m})]},j))}),e.jsx("div",{className:"btn-group",children:e.jsx(b,{variant:"primary",onClick:C,disabled:!n||d,children:d?"Creating...":"Continue"})})]})]})},K=({words:s})=>{const t=Array.isArray(s)?s.filter(o=>o&&o.word):[];return e.jsx("div",{className:"noise-floor",children:e.jsx("div",{className:"noise-words",children:t.map((o,n)=>{const r=o.similarity||0,d=Math.min(Math.max(r*100,0),100);return e.jsx("span",{className:"noise-word","data-similarity":r.toFixed(2),style:{"--similarity-width":`${d}%`},title:`Similarity: ${r.toFixed(2)}`,children:o.word},`${o.word}-${n}`)})})})};function M(s){s=s.toLowerCase();const t=["ically","ation","ness","ment","able","ible","tion","sion","ally","ful","less","ing","ity","ous","ive","est","ier","ies","ied","ly","ed","er","en","es","s"];for(const o of t)if(s.endsWith(o)&&s.length>o.length+2)return s.slice(0,-o.length);return s}function A(s,t){const o=s.toLowerCase(),n=t.toLowerCase();return!!(o===n||(o.startsWith(n)||n.startsWith(o))&&Math.abs(o.length-n.length)<=4||M(o)===M(n))}const V=({gameId:s,noiseFloor:t,seedWord:o})=>{const{dispatch:n}=I(),[r,d]=c.useState(["","","","",""]),[h,C]=c.useState(!1),[m,j]=c.useState(null),g=(a,l)=>{const i=[...r];i[a]=l,d(i),j(null)},x=c.useMemo(()=>{const a=o.toLowerCase(),l=[];return r.map(i=>{const f=i.trim().toLowerCase();if(!f)return{status:"empty"};if(A(f,a))return{status:"invalid",error:`Too similar to target "${o}"`};for(const w of l)if(A(f,w))return{status:"invalid",error:`Duplicate of "${w}"`};const y=t.some(w=>w.word.toLowerCase()===f);return l.push(f),y?{status:"warning"}:{status:"valid"}})},[r,o,t]),v=x.filter(a=>a.status==="valid"||a.status==="warning").length,S=x.some(a=>a.status==="invalid"),T=v>0&&!S&&!h,p=async a=>{if(a.preventDefault(),!!T){C(!0),j(null);try{const l=r.filter((f,y)=>x[y].status==="valid"||x[y].status==="warning").map(f=>f.trim());await k.games.submitClues(s,{clues:l});const i=await k.games.get(s);n({type:"GAME_COMPLETED",game:i})}catch(l){j(l instanceof Error?l.message:"Failed to submit concepts")}finally{C(!1)}}};return e.jsxs("div",{children:[e.jsx(E,{currentStep:2}),e.jsxs("p",{className:"subtitle",children:[e.jsx("span",{className:"subtitle-id",children:"INS-001.1"})," Â· Step 2 of 3"]}),e.jsx("h1",{className:"title",children:"Provide your concepts."}),e.jsxs("p",{className:"description",children:["Enter single-word concepts that will help someone guess your target word:"," ",e.jsx("span",{className:"target-word",children:o})]}),e.jsxs(N,{title:"Semantic Neighborhood",meta:"Top 10 predictable associations",children:[e.jsx(K,{words:t}),e.jsx("p",{className:"hint-text",children:"These are the most predictable associations. Your divergence score measures how far your concepts venture from this neighborhood."})]}),e.jsxs("form",{onSubmit:p,children:[e.jsx(N,{title:"Your Concepts",meta:`${v}/5 concepts`,children:e.jsxs("div",{className:"clue-inputs",children:[r.map((a,l)=>{const i=x[l],f=i.status==="valid",y=i.status==="invalid",w=i.status==="warning",u=i.status==="empty";return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--space-sm)",marginBottom:"var(--space-sm)"},children:[e.jsx("span",{style:{fontFamily:"var(--font-mono)",fontSize:"0.75rem",color:"var(--faded)",width:"20px"},children:l+1}),e.jsx("input",{type:"text",className:"text-input",value:a,onChange:F=>g(l,F.target.value),placeholder:l===0?"first concept":"",autoComplete:"off",spellCheck:"false",autoFocus:l===0,disabled:h,style:{flex:1,marginBottom:0,borderColor:y?"var(--alert)":w?"var(--gold)":f?"var(--active)":void 0}}),e.jsxs("span",{style:{fontFamily:"var(--font-mono)",fontSize:"0.65rem",minWidth:"60px",textAlign:"right",color:y?"var(--alert)":w?"var(--gold)":f?"var(--active)":"var(--faded)"},children:[y&&"âœ—",w&&"âš ",f&&"âœ“",u&&l>0&&"(optional)"]})]},l)}),x.map((a,l)=>a.status==="invalid"&&a.error?e.jsxs("div",{style:{color:"var(--alert)",fontFamily:"var(--font-mono)",fontSize:"0.7rem",marginTop:"var(--space-xs)"},children:["Concept ",l+1,": ",a.error]},`error-${l}`):null),e.jsx("p",{className:"input-hint",style:{marginTop:"var(--space-sm)"},children:"At least 1 concept required. More concepts provide more signal."})]})}),m&&e.jsxs("div",{className:"error-message",children:["â—ˆ ",m]}),e.jsxs("div",{className:"btn-group",children:[e.jsx(b,{variant:"ghost",onClick:()=>n({type:"BACK"}),type:"button",children:"â† Back"}),e.jsx(b,{type:"submit",variant:"primary",disabled:!T,children:h?"Submitting...":"Submit"})]})]})]})},L=({icon:s,title:t,description:o,onClick:n})=>e.jsxs("div",{className:"share-option",onClick:n,children:[e.jsx("div",{className:"share-option-icon",children:s}),e.jsx("div",{className:"share-option-title",children:t}),e.jsx("div",{className:"share-option-desc",children:o})]}),X=({onClaudeClick:s,onFriendClick:t})=>e.jsxs("div",{className:"share-options",children:[e.jsx(L,{icon:"ðŸ¤–",title:"Claude (AI)",description:"Instant results. Measure how well an LLM decodes your associations.",onClick:s}),e.jsx(L,{icon:"ðŸ”—",title:"Send to a Friend",description:"Generate a link. Measure network convergence with someone you know.",onClick:t})]}),q=({gameId:s,divergence:t})=>{const{dispatch:o}=I(),[n,r]=c.useState(null),[d,h]=c.useState(null),[C,m]=c.useState(!1),[j,g]=c.useState(null),[x,v]=c.useState(!1),S=async()=>{m(!0),g(null);try{const i=await k.share.createToken(s);r(i.token),h(i.share_url),v(!0)}catch(i){g(i instanceof Error?i.message:"Failed to create share link")}finally{m(!1)}},T=async()=>{try{const i=await k.games.get(s);o({type:"GAME_COMPLETED",game:i})}catch(i){g(i instanceof Error?i.message:"Failed to load results")}},p=()=>{d?v(!0):S()},a=t<.3?"Conventional":t<.6?"Moderate":"High Divergence",l=t<.3?"Your clues align closely with predictable associations.":t<.6?"Your clues show moderate deviation from predictable associations.":"Your clues venture significantly from predictable associations.";return e.jsxs("div",{children:[e.jsx(E,{currentStep:3}),e.jsxs("p",{className:"subtitle",children:[e.jsx("span",{className:"id",children:"INS-001.1"})," Â· Step 3 of 3"]}),e.jsx("h1",{className:"title",children:"Who will guess?"}),e.jsx("p",{className:"description",children:"Your divergence score is ready. Now choose who will attempt to decode your associations."}),e.jsxs(N,{className:"",style:{borderColor:"var(--gold)"},children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("span",{className:"panel-title",children:"Your Divergence Score"}),e.jsx("span",{className:"panel-meta",children:"Calculated"})]}),e.jsxs("div",{className:"panel-content",style:{display:"flex",alignItems:"center",gap:"var(--space-lg)"},children:[e.jsx("div",{style:{fontFamily:"var(--font-serif)",fontSize:"3rem",fontWeight:"300",color:"var(--gold)"},children:t.toFixed(2)}),e.jsxs("div",{children:[e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.75rem",color:"var(--text-light)"},children:a}),e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.65rem",color:"var(--faded)"},children:l})]})]})]}),e.jsx(X,{onClaudeClick:T,onFriendClick:p}),x&&d&&e.jsxs("div",{style:{marginTop:"var(--space-lg)",borderTop:"1px solid var(--faded-light)",paddingTop:"var(--space-md)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end",marginBottom:"var(--space-xs)"},children:[e.jsx("p",{className:"mono-label",style:{margin:0},children:"Share Link"}),e.jsx("span",{style:{fontFamily:"var(--font-mono)",fontSize:"0.6rem",color:"var(--active)"},children:"â— Link Active (expires 7d)"})]}),e.jsx(D,{url:d}),e.jsx("div",{style:{marginTop:"var(--space-md)",background:"var(--faded-ultra)",padding:"var(--space-sm)",border:"1px solid var(--faded-light)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"var(--space-sm)",flexWrap:"wrap"},children:[e.jsxs("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.65rem",color:"var(--text-light)",flex:1,minWidth:"180px"},children:[e.jsx("strong",{style:{color:"var(--gold)"},children:"Don't miss the results."}),e.jsx("br",{}),e.jsx("span",{style:{color:"var(--faded)"},children:"Create an account to be notified when your friend guesses."})]}),e.jsx(b,{variant:"secondary",style:{fontSize:"0.65rem",padding:"6px 12px",whiteSpace:"nowrap"},onClick:()=>{},children:"Notify Me"})]})}),e.jsx("div",{style:{marginTop:"var(--space-md)",textAlign:"right"},children:e.jsx(b,{variant:"ghost",onClick:async()=>{try{const i=await k.games.get(s);o({type:"GAME_COMPLETED",game:i})}catch(i){g(i instanceof Error?i.message:"Failed to load results")}},children:"View Session Dashboard â†’"})})]}),j&&e.jsxs("div",{style:{color:"var(--alert)",marginTop:"1rem",fontSize:"var(--text-sm)"},children:["â—ˆ ",j]}),e.jsx("div",{className:"btn-group",children:e.jsx(b,{variant:"ghost",onClick:()=>o({type:"BACK"}),children:"â† Back"})})]})};function J({shareUrl:s,isCreatingShare:t,shareError:o,onCreateShare:n}){return e.jsxs("div",{style:{marginBottom:"var(--space-lg)"},children:[e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.75rem",color:"var(--faded)",marginBottom:"var(--space-xs)",letterSpacing:"0.02em",fontStyle:"italic",textAlign:"center",marginLeft:"92px"},children:"compare your concepts"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--space-sm)"},children:[e.jsx("div",{style:{width:"80px",fontFamily:"var(--font-mono)",fontSize:"0.65rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--text-light)"},children:"Human"}),e.jsxs("div",{style:{flex:1,height:"32px",position:"relative",backgroundColor:"rgba(255, 255, 255, 0.08)",borderRadius:"2px",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{style:{position:"absolute",left:"10%",right:"10%",top:"50%",height:"1px",borderTop:"1px dashed var(--faded-light)",transform:"translateY(-50%)"}}),!s&&e.jsx("div",{style:{position:"relative",zIndex:1},children:e.jsx(b,{variant:"secondary",onClick:n,disabled:t,style:{fontSize:"0.65rem",padding:"4px 12px"},children:t?"Creating...":"Create Share Link"})})]})]}),s&&e.jsx("div",{style:{marginTop:"var(--space-sm)",marginLeft:"92px"},children:e.jsx(D,{url:s})}),o&&e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.6rem",color:"var(--alert)",marginTop:"var(--space-xs)",marginLeft:"92px"},children:o})]})}function z({label:s,concepts:t,relevance:o,spread:n,isYou:r}){const d=h=>Math.min(100,Math.max(0,h));return e.jsxs("div",{style:{marginBottom:"var(--space-lg)"},children:[e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.75rem",color:r?"var(--gold)":"var(--text-light)",marginBottom:"var(--space-xs)",letterSpacing:"0.02em",textAlign:"center",marginLeft:"92px"},children:t.join(" Â· ")}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--space-sm)"},children:[e.jsx("div",{style:{width:"80px",fontFamily:"var(--font-mono)",fontSize:"0.65rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",color:r?"var(--gold)":"var(--text-light)"},children:s}),e.jsxs("div",{style:{flex:1,height:"32px",position:"relative",backgroundColor:"rgba(255, 255, 255, 0.08)",borderRadius:"2px",marginBottom:"16px"},children:[[25,50,75].map(h=>e.jsx("div",{style:{position:"absolute",left:`${h}%`,top:0,bottom:0,width:"1px",backgroundColor:"rgba(255, 255, 255, 0.05)"}},h)),e.jsx("div",{style:{position:"absolute",left:`${Math.min(d(o),d(n))}%`,width:`${Math.abs(d(n)-d(o))}%`,top:"50%",height:"2px",backgroundColor:"var(--gold)",opacity:.4,transform:"translateY(-50%)"}}),e.jsx("div",{style:{position:"absolute",left:`${d(o)}%`,top:"50%",transform:"translate(-50%, -50%)",width:"12px",height:"12px",borderRadius:"50%",backgroundColor:"var(--gold)"}}),e.jsx("div",{style:{position:"absolute",left:`${d(n)}%`,top:"50%",transform:"translate(-50%, -50%)",width:"12px",height:"12px",borderRadius:"50%",border:"2px solid var(--gold)",backgroundColor:"var(--bg)",boxSizing:"border-box"}}),e.jsx("span",{style:{position:"absolute",left:`${d(o)}%`,bottom:"-16px",transform:"translateX(-50%)",fontFamily:"var(--font-mono)",fontSize:"0.6rem",color:"var(--gold)"},children:Math.round(o)}),e.jsx("span",{style:{position:"absolute",left:`${d(n)}%`,bottom:"-16px",transform:"translateX(-50%)",fontFamily:"var(--font-mono)",fontSize:"0.6rem",color:"var(--faded)"},children:Math.round(n)})]})]})]})}const Q=()=>{const{state:s,dispatch:t}=I(),{user:o,loading:n}=R(),r=s.screen==="results"?s.game:null,[d,h]=c.useState(!1),[C,m]=c.useState(null),[j,g]=c.useState(!1),[x,v]=c.useState(null),S=o?.email&&!o?.is_anonymous;if(!r)return null;const T=async()=>{if(r.game_id){g(!0),v(null);try{const u=await k.share.createToken(r.game_id),F=`${window.location.origin}/ins-001-1/join/${u.token}`;m(F)}catch(u){v(u instanceof Error?u.message:"Failed to create share link")}finally{g(!1)}}},p=r.spread??(r.divergence_score??0)*100,a=r.relevance!==void 0?r.relevance*100:(r.convergence_score??0)*100,l=r.recipient_type==="llm"&&r.guesses&&r.guesses.length>0,i=r.guess_similarities?r.guess_similarities.reduce((u,F)=>u+F,0)/r.guess_similarities.length*100:0,f=r.guess_similarities&&r.guess_similarities.length>1?Math.min(100,Math.max(0,(1-Math.max(...r.guess_similarities)+Math.min(...r.guess_similarities))*100)):50,y=p<30?"Low":p<60?"Moderate":"High",w=a<40?"Weak":a<70?"Moderate":"Strong";return e.jsxs("div",{children:[e.jsxs("p",{className:"subtitle",children:[e.jsx("span",{className:"id",children:"INS-001.1"})," Â· Complete"]}),e.jsx("h1",{className:"title",children:"Results."}),e.jsx("p",{className:"description",children:"Your semantic association profile for this session."}),e.jsxs(N,{children:[e.jsxs("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.8rem",color:"var(--gold)",textAlign:"center",marginBottom:"var(--space-lg)"},children:["Target: ",r.seed_word]}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"var(--space-md)",marginBottom:"var(--space-md)",fontFamily:"var(--font-mono)",fontSize:"0.6rem",textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--faded)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"var(--gold)"}}),e.jsx("span",{children:"Relevance"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",border:"2px solid var(--gold)",backgroundColor:"transparent",boxSizing:"border-box"}}),e.jsx("span",{children:"Spread"})]})]}),e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.6rem",color:"var(--faded)",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"var(--space-xs)",marginTop:"var(--space-md)"},children:"Your Clues"}),e.jsxs("div",{style:{marginLeft:"92px",marginRight:"12px",marginBottom:"var(--space-sm)"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",fontFamily:"var(--font-mono)",fontSize:"11px",color:"var(--faded)",marginBottom:"2px"},children:[0,25,50,75,100].map(u=>e.jsx("span",{children:u},u))}),e.jsx("div",{style:{height:"1px",backgroundColor:"var(--border)",position:"relative"},children:[0,25,50,75,100].map(u=>e.jsx("div",{style:{position:"absolute",left:`${u}%`,top:"-2px",width:"1px",height:"5px",backgroundColor:"var(--border)"}},u))})]}),e.jsxs("div",{style:{marginTop:"var(--space-md)"},children:[e.jsx(z,{label:"You",concepts:r.clues||[],relevance:a,spread:p,isYou:!0}),(l||r.noise_floor&&r.noise_floor.length>0)&&e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.6rem",color:"var(--faded)",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"var(--space-xs)",marginTop:"var(--space-lg)",paddingTop:"var(--space-md)",borderTop:"1px solid var(--border)"},children:"Guesses (from your clues)"}),l&&e.jsx(z,{label:"Haiku",concepts:r.guesses||[],relevance:i,spread:f}),r.noise_floor&&r.noise_floor.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.6rem",color:"var(--faded)",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"var(--space-xs)",marginTop:"var(--space-lg)",paddingTop:"var(--space-md)",borderTop:"1px solid var(--border)"},children:"Noise Floor (predictable associations)"}),e.jsx(z,{label:"Statistical",concepts:r.noise_floor.map(u=>u.word),relevance:r.noise_floor.reduce((u,F)=>u+F.similarity*100,0)/r.noise_floor.length,spread:50})]}),e.jsx(J,{shareUrl:C,isCreatingShare:j,shareError:x,onCreateShare:T})]})]}),e.jsxs(N,{className:"",style:{background:"transparent",borderColor:"var(--faded-light)"},children:[e.jsx("div",{className:"panel-header",children:e.jsx("span",{className:"panel-title",children:"Interpretation"})}),e.jsxs("div",{className:"panel-content",style:{fontFamily:"var(--font-body)",fontSize:"0.9rem",color:"var(--faded)",lineHeight:"1.7"},children:[e.jsxs("p",{style:{marginBottom:"var(--space-sm)"},children:["Your clues show ",y.toLowerCase()," spread (",Math.round(p),") with ",w.toLowerCase()," relevance (",Math.round(a),") to the target concept.",p>60&&a>50&&" This indicates creative but valid associations.",p<40&&a>50&&" This indicates conventional, predictable associations.",a<40&&" The associations may be too distant from the target concept."]}),l&&e.jsxs("p",{style:{marginBottom:0,fontSize:"0.8rem"},children:['Haiku guessed "',r.guesses?.join(", "),'" from your clues â€”',i>70?" accurately inferring the target.":i>40?" getting close to the target.":" struggling to identify the target."]})]})]}),e.jsxs(N,{className:"",style:{borderColor:S?"var(--active)":"var(--gold)",background:S?"linear-gradient(to bottom, var(--card-bg), rgba(85, 176, 120, 0.05))":"linear-gradient(to bottom, var(--card-bg), rgba(176, 141, 85, 0.05))"},children:[e.jsxs("div",{className:"panel-header",style:{borderBottomColor:S?"var(--active)":"var(--gold-dim)"},children:[e.jsx("span",{className:"panel-title",style:{color:S?"var(--active)":"var(--gold)"},children:S?"Registered Record":"Unregistered Record"}),e.jsxs("span",{className:"panel-meta",children:["Session ID: #",r.game_id?.slice(0,4).toUpperCase()||"----"]})]}),e.jsx("div",{className:"panel-content",children:S?e.jsx("div",{style:{display:"flex",gap:"var(--space-md)",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},children:e.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[e.jsxs("p",{style:{fontFamily:"var(--font-mono)",fontSize:"0.75rem",color:"var(--text-light)",marginBottom:"var(--space-xs)"},children:["Linked to ",o?.email]}),e.jsx("p",{style:{fontFamily:"var(--font-mono)",fontSize:"0.65rem",color:"var(--faded)",margin:0},children:"This session is saved to your cognitive profile."})]})}):e.jsxs("div",{style:{display:"flex",gap:"var(--space-md)",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},children:[e.jsx("div",{style:{flex:1,minWidth:"200px"},children:e.jsx("p",{style:{fontFamily:"var(--font-mono)",fontSize:"0.75rem",color:"var(--text-light)",marginBottom:"var(--space-xs)"},children:"Save your scores to your permanent cognitive profile."})}),e.jsx(b,{variant:"primary",style:{fontSize:"0.65rem",padding:"10px 20px"},onClick:()=>h(!0),children:"Initialize ID"})]})})]}),e.jsx("div",{className:"btn-group",children:e.jsx(b,{variant:"secondary",onClick:()=>{t({type:"RESET"}),window.location.reload()},children:"Play Again"})}),e.jsxs("footer",{className:"footer",children:[e.jsxs("div",{children:[e.jsx("a",{href:"/methods",style:{color:"var(--faded)",textDecoration:"none"},children:"Methodology"})," ","Â·"," ",e.jsx("a",{href:"/about",style:{color:"var(--faded)",textDecoration:"none"},children:"About Phronos"})," ","Â·"," ",e.jsx("a",{href:"/constitution",style:{color:"var(--faded)",textDecoration:"none"},children:"Constitution"})]}),e.jsx("div",{children:"Â© 2026 Phronos Observatory"})]}),e.jsx(G,{isOpen:d,onClose:()=>h(!1)})]})};function Z(){const{state:s}=I();switch(s.screen){case"intro":return e.jsx(_,{});case"seed":return e.jsx(H,{});case"sense":return e.jsx(U,{seedWord:s.seedWord,senseOptions:s.senseOptions});case"clues":return e.jsx(V,{gameId:s.gameId,noiseFloor:s.noiseFloor,seedWord:s.seedWord});case"share":return e.jsx(q,{gameId:s.gameId,divergence:s.divergence});case"results":return e.jsx(Q,{game:s.game});default:return e.jsx(_,{})}}function de(){return e.jsx(P,{children:e.jsxs(O,{children:[e.jsx($,{instrumentId:"INS-001.1",instrumentTitle:"SIGNAL"}),e.jsx(Z,{})]})})}export{de as default};
