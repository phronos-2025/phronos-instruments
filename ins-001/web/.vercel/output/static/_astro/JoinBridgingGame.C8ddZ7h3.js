import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as p}from"./index.WFquGv8Z.js";import{u as M,B as O}from"./bridging-state.BVL_BDqg.js";import{N as Y}from"./Navigation.Dg0Tvl9_.js";import{a as L}from"./api.Dr1Iqu3o.js";import{s as A}from"./supabase.Dq7CRccX.js";import{P as D,B as T}from"./Button.D4eF3GIc.js";import"./PhronosLogo.oVgHQy8-.js";import"./AuthProvider.mA6T2QvE.js";const E=({shareCode:r,gameId:t,anchor:l,target:c,senderStepCount:m})=>{const{dispatch:i}=M(),[d,z]=p.useState(t||""),[h,b]=p.useState(l||""),[v,w]=p.useState(c||""),[x,C]=p.useState(m||0),[f,R]=p.useState(["","","","",""]),[y,N]=p.useState(!t),[S,_]=p.useState(!1),[j,u]=p.useState(null);p.useEffect(()=>{if(t&&l&&c){i({type:"GAME_LOADED_V2",gameId:t,anchor:l,target:c,senderStepCount:m||0});return}(async()=>{try{const{data:{session:s}}=await A.auth.getSession();s||await A.auth.signInAnonymously();const o=await L.bridging.joinV2(r);z(o.game_id),b(o.anchor_word),w(o.target_word),C(o.sender_clue_count),N(!1),i({type:"GAME_LOADED_V2",gameId:o.game_id,anchor:o.anchor_word,target:o.target_word,senderStepCount:o.sender_clue_count})}catch(s){N(!1);const o=s instanceof Error?s.message:"Failed to join game";u(o),i({type:"ERROR",message:o})}})()},[r,t,l,c,m,i]);const I=(g,s)=>{const o=[...f];o[g]=s,R(o)},a=()=>f.filter(g=>g.trim().length>0),$=async g=>{g.preventDefault();const s=a();if(s.length===0){u("Please enter at least one concept");return}const o=h.toLowerCase(),G=v.toLowerCase();for(const n of s){const B=n.trim().toLowerCase();if(B===o||B===G){u("Concepts cannot be the anchor or target words");return}}_(!0),u(null);try{const n=await L.bridging.submitBridge(d,{clues:s.map(B=>B.trim().toLowerCase())});i({type:"BRIDGE_SUBMITTED",senderSteps:n.sender_clues,senderRelevance:n.sender_relevance,senderDivergence:n.sender_divergence,recipientSteps:n.recipient_clues,recipientRelevance:n.recipient_relevance,recipientDivergence:n.recipient_divergence,bridgeSimilarity:n.bridge_similarity,centroidSimilarity:n.centroid_similarity,pathAlignment:n.path_alignment,haikuClues:n.haiku_clues,haikuRelevance:n.haiku_relevance,haikuDivergence:n.haiku_divergence,lexicalBridge:n.lexical_bridge,lexicalRelevance:n.lexical_relevance,lexicalDivergence:n.lexical_divergence})}catch(n){u(n instanceof Error?n.message:"Failed to submit union")}finally{_(!1)}};if(y)return e.jsxs("div",{style:{textAlign:"center",padding:"2rem"},children:[e.jsxs("p",{className:"subtitle",children:[e.jsx("span",{className:"id",children:"INS-001.2"})," · Loading"]}),e.jsx("h1",{className:"title",children:"Joining game..."}),e.jsx("div",{style:{color:"var(--faded)",fontFamily:"var(--font-mono)",fontSize:"0.85rem"},children:"Preparing..."})]});if(j&&!d)return e.jsxs("div",{style:{textAlign:"center",padding:"2rem"},children:[e.jsxs("p",{className:"subtitle",children:[e.jsx("span",{className:"id",children:"INS-001.2"})," · Error"]}),e.jsx("h1",{className:"title",children:"Could not join game."}),e.jsx("p",{style:{color:"var(--alert)",fontFamily:"var(--font-mono)",fontSize:"0.85rem",marginBottom:"var(--space-lg)"},children:j}),e.jsx("a",{href:"/ins-001-2",style:{color:"var(--gold)",fontFamily:"var(--font-mono)"},children:"Find your own common ground →"})]});const k=a().length;return e.jsxs("div",{children:[e.jsxs("p",{className:"subtitle",children:[e.jsx("span",{className:"id",children:"INS-001.2"})," · Find Common Ground"]}),e.jsx("h1",{className:"title",children:"Connect these concepts."}),e.jsx("p",{className:"description",children:"Someone found common ground between these two words. Now find your own."}),e.jsxs(D,{style:{marginBottom:"var(--space-lg)",textAlign:"center"},children:[e.jsxs("div",{style:{fontFamily:"var(--font-mono)",fontSize:"1.25rem",color:"var(--gold)",display:"flex",alignItems:"center",justifyContent:"center",gap:"var(--space-md)"},children:[e.jsx("span",{style:{fontWeight:600},children:h}),e.jsx("span",{style:{color:"var(--faded)",fontSize:"0.9rem",letterSpacing:"0.1em"},children:"←――――――――――→"}),e.jsx("span",{style:{fontWeight:600},children:v})]}),x>0&&e.jsxs("div",{style:{marginTop:"var(--space-sm)",color:"var(--faded)",fontFamily:"var(--font-mono)",fontSize:"0.75rem"},children:["Their common ground used ",x," concept",x!==1?"s":""]})]}),e.jsxs("p",{className:"description",children:["Enter 1-5 concepts that connect ",e.jsx("strong",{children:h})," to"," ",e.jsx("strong",{children:v}),":"]}),e.jsxs("form",{onSubmit:$,children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"var(--space-sm)",marginBottom:"var(--space-lg)"},children:f.map((g,s)=>e.jsx("div",{className:"input-group",style:{marginBottom:0},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--space-sm)"},children:[e.jsxs("span",{style:{color:s===0?"var(--gold)":"var(--faded)",fontFamily:"var(--font-mono)",fontSize:"0.75rem",width:"1.5rem",textAlign:"right"},children:[s+1,"."]}),e.jsx("input",{type:"text",className:"text-input",value:g,onChange:o=>I(s,o.target.value),placeholder:s===0?"first concept (required)":"optional concept",autoComplete:"off",spellCheck:"false",autoFocus:s===0,disabled:S,style:{flex:1}})]})},s))}),e.jsx("div",{style:{textAlign:"center",marginBottom:"var(--space-md)",color:"var(--faded)",fontFamily:"var(--font-mono)",fontSize:"0.75rem"},children:k===0?"Enter at least one concept":`${k} concept${k!==1?"s":""} entered`}),j&&e.jsxs("div",{style:{color:"var(--alert)",marginBottom:"var(--space-md)",fontSize:"var(--text-sm)",textAlign:"center"},children:["◈ ",j]}),e.jsx("div",{className:"btn-group",style:{justifyContent:"center"},children:e.jsx(T,{type:"submit",variant:"primary",disabled:k===0||S,children:S?"Comparing...":"Compare"})})]})]})};function F({label:r,concepts:t,relevance:l,spread:c,isYou:m}){const i=d=>Math.min(100,Math.max(0,d));return e.jsxs("div",{style:{marginBottom:"var(--space-lg)"},children:[e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.75rem",color:m?"var(--gold)":"var(--text-light)",marginBottom:"var(--space-xs)",letterSpacing:"0.02em",textAlign:"center",marginLeft:"92px"},children:t.join(" · ")}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"var(--space-sm)"},children:[e.jsx("div",{style:{width:"80px",fontFamily:"var(--font-mono)",fontSize:"0.65rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",color:m?"var(--gold)":"var(--text-light)"},children:r}),e.jsxs("div",{style:{flex:1,height:"32px",position:"relative",backgroundColor:"rgba(255, 255, 255, 0.08)",borderRadius:"2px",marginBottom:"16px"},children:[[25,50,75].map(d=>e.jsx("div",{style:{position:"absolute",left:`${d}%`,top:0,bottom:0,width:"1px",backgroundColor:"rgba(255, 255, 255, 0.05)"}},d)),e.jsx("div",{style:{position:"absolute",left:`${i(l)}%`,width:`${Math.max(0,i(c)-i(l))}%`,top:"50%",height:"2px",backgroundColor:"var(--gold)",opacity:.4,transform:"translateY(-50%)"}}),e.jsx("div",{style:{position:"absolute",left:`${i(l)}%`,top:"50%",transform:"translate(-50%, -50%)",width:"12px",height:"12px",borderRadius:"50%",backgroundColor:"var(--gold)"}}),e.jsx("div",{style:{position:"absolute",left:`${i(c)}%`,top:"50%",transform:"translate(-50%, -50%)",width:"12px",height:"12px",borderRadius:"50%",border:"2px solid var(--gold)",backgroundColor:"var(--bg)",boxSizing:"border-box"}}),e.jsx("span",{style:{position:"absolute",left:`${i(l)}%`,bottom:"-16px",transform:"translateX(-50%)",fontFamily:"var(--font-mono)",fontSize:"0.6rem",color:"var(--gold)"},children:Math.round(l)}),e.jsx("span",{style:{position:"absolute",left:`${i(c)}%`,bottom:"-16px",transform:"translateX(-50%)",fontFamily:"var(--font-mono)",fontSize:"0.6rem",color:"var(--faded)"},children:Math.round(c)})]})]})]})}function P({score:r,color:t="var(--gold)"}){return e.jsx("div",{style:{background:"var(--bg-card)",borderRadius:"4px",height:"8px",overflow:"hidden"},children:e.jsx("div",{style:{background:t,height:"100%",width:`${Math.min(100,r)}%`,transition:"width 0.3s ease"}})})}function H(r){return r>=80?{text:"Highly similar common ground",description:"You and the sender navigated this connection almost identically."}:r>=60?{text:"Similar common ground",description:"You took a related conceptual path between these words."}:r>=40?{text:"Different approaches",description:"You found a distinct route connecting these concepts."}:{text:"Divergent common ground",description:"You and the sender had very different ways of connecting these ideas."}}const J=({anchor:r,target:t,senderSteps:l,senderRelevance:c,senderDivergence:m,recipientSteps:i,recipientRelevance:d,recipientDivergence:z,bridgeSimilarity:h,haikuClues:b,haikuRelevance:v,haikuDivergence:w,lexicalBridge:x,lexicalRelevance:C,lexicalDivergence:f})=>{const R=H(h),y=a=>a==null?0:a<=1?a*100:a,N=y(d),S=y(c),_=y(v),j=y(C),u=b&&b.length>0&&v!==void 0&&w!==void 0,I=x&&x.length>0&&C!==void 0&&f!==void 0;return e.jsxs("div",{children:[e.jsxs("p",{className:"subtitle",children:[e.jsx("span",{className:"id",children:"INS-001.2"})," · Common Ground Comparison"]}),e.jsx("h1",{className:"title",children:R.text}),e.jsxs(D,{children:[e.jsxs("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.8rem",color:"var(--gold)",textAlign:"center",marginBottom:"var(--space-lg)"},children:[r," ←―――――――――――――――――――――→ ",t]}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"var(--space-md)",marginBottom:"var(--space-md)",fontFamily:"var(--font-mono)",fontSize:"0.6rem",textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--faded)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"var(--gold)"}}),e.jsx("span",{children:"Relevance"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",border:"2px solid var(--gold)",backgroundColor:"transparent",boxSizing:"border-box"}}),e.jsx("span",{children:"Spread"})]})]}),e.jsxs("div",{style:{marginLeft:"92px",marginRight:"12px",marginBottom:"var(--space-sm)"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",fontFamily:"var(--font-mono)",fontSize:"11px",color:"var(--faded)",marginBottom:"2px"},children:[0,25,50,75,100].map(a=>e.jsx("span",{children:a},a))}),e.jsx("div",{style:{height:"1px",backgroundColor:"var(--border)",position:"relative"},children:[0,25,50,75,100].map(a=>e.jsx("div",{style:{position:"absolute",left:`${a}%`,top:"-2px",width:"1px",height:"5px",backgroundColor:"var(--border)"}},a))})]}),e.jsxs("div",{style:{marginTop:"var(--space-md)"},children:[e.jsx(F,{label:"You",concepts:i,relevance:N,spread:z,isYou:!0}),e.jsx(F,{label:"Them",concepts:l,relevance:S,spread:m}),u&&e.jsx(F,{label:"Haiku",concepts:b,relevance:_,spread:w}),I&&e.jsx(F,{label:"Statistical",concepts:x,relevance:j,spread:f})]})]}),e.jsxs(D,{title:"Common Ground Similarity",meta:`${Math.round(h)}%`,style:{marginTop:"var(--space-md)"},children:[e.jsx(P,{score:h}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontFamily:"var(--font-mono)",fontSize:"0.65rem",color:"var(--faded)",marginTop:"var(--space-xs)"},children:[e.jsx("span",{children:"divergent"}),e.jsx("span",{children:"identical"})]})]}),e.jsx(D,{style:{background:"transparent",borderColor:"var(--gold-dim)",marginTop:"var(--space-md)"},children:e.jsx("div",{style:{fontFamily:"var(--font-mono)",fontSize:"0.75rem",color:"var(--faded)"},children:e.jsx("strong",{style:{color:"var(--text-light)"},children:R.description})})}),e.jsx("div",{className:"btn-group",style:{justifyContent:"center",marginTop:"var(--space-lg)"},children:e.jsx(T,{variant:"primary",onClick:()=>window.location.href="/ins-001-2",children:"Find Your Own Common Ground"})})]})};function V({shareCode:r}){const{state:t}=M();switch(t.screen){case"loading":return e.jsx(E,{shareCode:r});case"error":return e.jsxs("div",{style:{textAlign:"center",padding:"2rem"},children:[e.jsxs("p",{className:"subtitle",children:[e.jsx("span",{className:"id",children:"INS-001.2"})," · Error"]}),e.jsx("h1",{className:"title",children:"Something went wrong."}),e.jsx("p",{style:{color:"var(--alert)",fontFamily:"var(--font-mono)",fontSize:"0.85rem"},children:t.message}),e.jsx("a",{href:"/ins-001-2",style:{display:"inline-block",marginTop:"var(--space-lg)",color:"var(--gold)",fontFamily:"var(--font-mono)"},children:"Create your own bridge →"})]});case"build-bridge":return e.jsx(E,{shareCode:r,gameId:t.gameId,anchor:t.anchor,target:t.target,senderStepCount:t.senderStepCount});case"comparison":return e.jsx(J,{anchor:t.anchor,target:t.target,senderSteps:t.senderSteps,senderRelevance:t.senderRelevance,senderDivergence:t.senderDivergence,recipientSteps:t.recipientSteps,recipientRelevance:t.recipientRelevance,recipientDivergence:t.recipientDivergence,bridgeSimilarity:t.bridgeSimilarity,haikuClues:t.haikuClues,haikuRelevance:t.haikuRelevance,haikuDivergence:t.haikuDivergence,lexicalBridge:t.lexicalBridge,lexicalRelevance:t.lexicalRelevance,lexicalDivergence:t.lexicalDivergence});default:return e.jsx(E,{shareCode:r})}}function ne({shareCode:r}){return e.jsxs(O,{children:[e.jsx(Y,{instrumentId:"INS-001.2",instrumentTitle:"COMMON GROUND"}),e.jsx(V,{shareCode:r})]})}export{ne as default};
