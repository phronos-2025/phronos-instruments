import{s as d}from"./supabase.Dq7CRccX.js";function m(e){const t=e.trim();return t.startsWith("http://")||t.startsWith("https://")?t:`https://${t}`}const l="http://localhost:8000",h=m(l);async function p(){let{data:{session:e},error:t}=await d.auth.getSession();if(t){console.error("Session error in getAuthHeaders:",t);const{data:i,error:n}=await d.auth.signInAnonymously();if(n)throw new Error(`Authentication failed: ${n.message}`);e=i.session}if(!e){const{data:i,error:n}=await d.auth.signInAnonymously();if(n)throw console.error("Failed to sign in anonymously:",n),new Error(`Authentication failed: ${n.message}`);e=i.session}const o={"Content-Type":"application/json"};if(e?.access_token)o.Authorization=`Bearer ${e.access_token}`;else throw console.error("No access token in session:",e),new Error("No access token available. Please refresh the page.");return o}async function r(e,t={}){const o=await p();let i=h.replace(/\/$/,"");!i.startsWith("http://")&&!i.startsWith("https://")&&(i=`https://${i}`);const n=e.startsWith("/")?e:`/${e}`,u=`${i}${n}`;try{const s=await fetch(u,{...t,credentials:"include",headers:{...o,...t.headers}});if(!s.ok){let a=`HTTP ${s.status} ${s.statusText}`;try{const g=await s.json(),c=g.detail||g.message||g.error||a;typeof c=="object"&&c!==null?a=c.message||JSON.stringify(c):a=String(c)}catch{try{a=await s.text()||a}catch{}}throw s.status===403&&(a=`403 Forbidden: ${a}`),new Error(a)}return s.json()}catch(s){if(s instanceof TypeError&&(s.message.includes("fetch")||s.message.includes("Failed to fetch"))){const a=typeof window<"u"?window.location.origin:"unknown";throw s.message.includes("CORS")||s.message.includes("Access-Control")?new Error(`CORS error: API at ${h} is blocking requests from ${a}`):new Error(`Network error: Cannot connect to API at ${h}`)}throw s}}const b={games:{create:e=>r("/api/v1/games/",{method:"POST",body:JSON.stringify(e)}),get:e=>r(`/api/v1/games/${e}`),submitClues:(e,t)=>r(`/api/v1/games/${e}/clues`,{method:"POST",body:JSON.stringify(t)}),submitGuesses:(e,t)=>r(`/api/v1/games/${e}/guesses`,{method:"POST",body:JSON.stringify(t)}),suggest:e=>{const t=new URLSearchParams;e&&t.set("attempt",e.toString());const o=t.toString();return r(`/api/v1/bridging/suggest${o?`?${o}`:""}`)}},share:{createToken:e=>r(`/api/v1/games/${e}/share`,{method:"POST"}),join:e=>r(`/api/v1/join/${e}`,{method:"POST"})},embeddings:{validate:e=>r("/api/v1/embeddings/validate",{method:"POST",body:JSON.stringify({word:e})})},bridging:{create:e=>r("/api/v1/bridging/",{method:"POST",body:JSON.stringify(e)}),get:e=>r(`/api/v1/bridging/${e}`),submitClues:(e,t)=>r(`/api/v1/bridging/${e}/clues`,{method:"POST",body:JSON.stringify(t)}),submitGuess:(e,t)=>r(`/api/v1/bridging/${e}/guess`,{method:"POST",body:JSON.stringify(t)}),suggest:(e,t)=>{const o=new URLSearchParams;e&&o.set("from_word",e),t&&o.set("attempt",t.toString());const i=o.toString();return r(`/api/v1/bridging/suggest${i?`?${i}`:""}`)},createShare:e=>r(`/api/v1/bridging/${e}/share`,{method:"POST"}),join:e=>r(`/api/v1/bridging/join/${e}`,{method:"POST"}),triggerHaikuGuess:e=>r(`/api/v1/bridging/${e}/haiku-guess`,{method:"POST"}),triggerHaikuBridge:e=>r(`/api/v1/bridging/${e}/haiku-bridge`,{method:"POST"}),getDistance:(e,t)=>r(`/api/v1/bridging/distance?anchor=${encodeURIComponent(e)}&target=${encodeURIComponent(t)}`),joinV2:e=>r(`/api/v1/bridging/join-v2/${e}`,{method:"POST"}),submitBridge:(e,t)=>r(`/api/v1/bridging/${e}/bridge`,{method:"POST",body:JSON.stringify(t)})}};export{b as a};
